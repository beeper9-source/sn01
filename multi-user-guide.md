# 다중 사용자 출석부 시스템 가이드

## 🎯 개요
수내체임버앙상블 출석부가 Supabase 데이터베이스와 연동되어 여러 명이 동시에 출석 데이터를 관리할 수 있도록 업그레이드되었습니다.

## ✨ 새로운 기능

### 1. 실시간 동기화
- **즉시 반영**: 한 사용자가 출석 상태를 변경하면 다른 사용자에게 즉시 반영
- **자동 동기화**: 10초마다 자동으로 최신 데이터 동기화
- **실시간 구독**: Supabase의 실시간 기능을 활용한 즉각적인 업데이트

### 2. 다중 사용자 지원
- **동시 접근**: 여러 명이 동시에 출석부에 접근하여 데이터 관리 가능
- **충돌 방지**: 데이터베이스 레벨에서 동시 수정 충돌 방지
- **일관성 보장**: 모든 사용자가 동일한 최신 데이터를 확인

### 3. 오프라인 지원
- **로컬 저장**: 인터넷 연결이 없어도 로컬에서 출석 관리 가능
- **자동 동기화**: 온라인 복구 시 자동으로 데이터 동기화
- **상태 표시**: 연결 상태를 실시간으로 표시

## 🚀 사용 방법

### 1. 기본 사용법
1. **브라우저에서 `index.html` 열기**
2. **회차 선택**: 상단의 드롭다운에서 원하는 회차 선택
3. **출석 관리**: 각 멤버의 출석/결석/미정 상태 클릭
4. **자동 저장**: 변경사항이 자동으로 데이터베이스에 저장됨

### 2. 다중 사용자 테스트
1. **테스트 페이지 열기**: `multi-user-test.html` 열기
2. **여러 탭 열기**: 같은 페이지를 2-3개의 탭에서 열기
3. **메인 앱 열기**: 각 탭에서 "메인 출석부 열기" 버튼 클릭
4. **동시 수정 테스트**: 한 탭에서 출석 상태 변경 후 다른 탭에서 반영 확인

### 3. 수동 동기화
- **저장 및 동기화 버튼**: 우측 하단의 버튼으로 수동 동기화 가능
- **상태 표시**: 동기화 상태가 실시간으로 표시됨
- **오류 처리**: 동기화 실패 시 자동으로 재시도

## 🔧 기술적 특징

### 데이터베이스 구조
```
members (멤버 정보)
├── id (기본키)
├── no (멤버 번호)
├── name (이름)
└── instrument (악기)

attendance_records (출석 기록)
├── id (기본키)
├── session_number (회차)
├── member_id (멤버 참조)
└── status (출석상태)
```

### 동기화 메커니즘
1. **로컬 우선**: 로컬 데이터를 먼저 업데이트하여 빠른 응답
2. **백그라운드 동기화**: 데이터베이스에 백그라운드에서 동기화
3. **실시간 구독**: 다른 사용자의 변경사항을 실시간으로 수신
4. **충돌 해결**: 데이터베이스 레벨에서 최신 데이터 우선 적용

### 오프라인 지원
- **로컬스토리지**: 브라우저 로컬스토리지에 데이터 임시 저장
- **큐잉**: 오프라인 중 변경사항을 큐에 저장
- **자동 복구**: 온라인 복구 시 큐의 모든 변경사항 자동 동기화

## 📊 성능 최적화

### 1. 빠른 응답
- **비동기 처리**: 모든 데이터베이스 작업을 비동기로 처리
- **로컬 캐싱**: 자주 사용하는 데이터를 로컬에 캐싱
- **지연 로딩**: 필요한 데이터만 선택적으로 로드

### 2. 효율적인 동기화
- **증분 동기화**: 변경된 데이터만 동기화
- **배치 처리**: 여러 변경사항을 한 번에 처리
- **압축**: 네트워크 전송량 최적화

## 🛠️ 문제 해결

### 일반적인 문제

**1. 동기화가 안 됨**
- 네트워크 연결 상태 확인
- 브라우저 개발자 도구에서 오류 메시지 확인
- "저장 및 동기화" 버튼으로 수동 동기화 시도

**2. 실시간 업데이트가 안 됨**
- Supabase 설정이 올바른지 확인
- 브라우저가 실시간 연결을 지원하는지 확인
- 페이지를 새로고침하여 재연결

**3. 오프라인에서 변경사항이 사라짐**
- 로컬스토리지가 비활성화되지 않았는지 확인
- 브라우저 설정에서 쿠키/로컬스토리지 허용 확인

### 고급 문제 해결

**1. 데이터베이스 연결 오류**
```javascript
// 브라우저 콘솔에서 확인
console.log('Supabase 설정:', window.validateSupabaseConfig());
console.log('Supabase 클라이언트:', window.supabaseClient);
```

**2. 실시간 구독 상태 확인**
```javascript
// 브라우저 콘솔에서 확인
supabase.getChannels().forEach(channel => {
    console.log('채널 상태:', channel.state);
});
```

## 🔒 보안 고려사항

### 1. 데이터 보안
- **RLS 정책**: Supabase Row Level Security로 데이터 접근 제어
- **API 키**: 공개 키만 사용하여 클라이언트 보안
- **HTTPS**: 모든 통신이 암호화됨

### 2. 사용자 인증 (향후 확장 가능)
- 현재는 공개 앱으로 모든 사용자가 접근 가능
- 필요시 Supabase Auth를 통한 사용자 인증 추가 가능

## 📈 모니터링 및 로그

### 1. 실시간 상태 모니터링
- **연결 상태**: 실시간으로 표시
- **동기화 상태**: 마지막 동기화 시간 표시
- **오류 로그**: 브라우저 콘솔에서 확인 가능

### 2. 성능 메트릭
- **응답 시간**: 출석 상태 변경 시 응답 시간
- **동기화 빈도**: 자동 동기화 실행 빈도
- **오류율**: 동기화 실패율

## 🎯 향후 개선 계획

### 1. 사용자 경험 개선
- **푸시 알림**: 중요한 변경사항에 대한 알림
- **오프라인 인디케이터**: 더 명확한 오프라인 상태 표시
- **충돌 해결 UI**: 동시 수정 시 사용자에게 선택권 제공

### 2. 기능 확장
- **출석 통계**: 개인별/악기별 출석률 통계
- **알림 시스템**: 결석자에 대한 자동 알림
- **백업/복원**: 데이터 백업 및 복원 기능

## 📞 지원 및 문의

### 기술 지원
- **브라우저 콘솔**: F12를 눌러 오류 메시지 확인
- **네트워크 탭**: 데이터베이스 연결 상태 확인
- **로컬스토리지**: 브라우저 개발자 도구에서 데이터 확인

### 문제 신고
- 구체적인 오류 메시지와 함께 신고
- 사용 중인 브라우저와 버전 정보 포함
- 재현 가능한 단계 설명
